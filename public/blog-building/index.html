<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=40795&amp;path=livereload" data-no-instant defer></script><meta property="og:url" content="http://localhost:40795/blog-building/">
  <meta property="og:site_name" content="BarrCodes">
  <meta property="og:title" content="Building a Responsive Blog With 56 Lines Of JavaScript">
  <meta property="og:description" content="My “Hello World” post about how I made this blog with no frameworks and client-side dependencies.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-21T00:00:00+00:00">

<!DOCTYPE html>
<html lang="en">
<head><title>Building a Responsive Blog With 56 Lines Of JavaScript - BarrCodes</title>
<link rel="stylesheet" href="/style.css"/>
<script src="/script.js"></script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<meta property="site_name" content="BarrCodes" />
<meta name="author" content=Barr />

<meta name="description" content=My&#32;“Hello&#32;World”&#32;post&#32;about&#32;how&#32;I&#32;made&#32;this&#32;blog&#32;with&#32;no&#32;frameworks&#32;and&#32;client-side&#32;dependencies. />

<meta name="keywords" content=Blog,&#32;HTML,&#32;CSS,&#32;JavaScript />
</head>
<body>
    <header><header class="header">
<div class="logo banneritem">
<span>B</span><span>a</span><span>r</span><span>r</span><span>C</span><span>o</span><span>d</span><span>e</span><span>s</span>
</div>
  <a class="headeritem" href="/">Home</a>
  <a class="headeritem" href="about">About Me</a>
  <button id="toggle_theme" onclick="toggle_theme()">Dark<br/>Theme</button>
</header>
</header>
    <main id="content">
      <h1 id="title">Building a Responsive Blog With 56 Lines Of JavaScript</h1>
      
<div style="text-align: right" class="date"><em>2024-11-21</em></div>
<p>For a long time I wanted to write more code, but didn&rsquo;t have a good reason to.
Now I have a solution: dump it all on a blog, maybe someone can learn something from it.
I&rsquo;m not a big fan of front-end design, JavaScript, and bloat in general, so I&rsquo;m pretty allergic to frameworks.
It can&rsquo;t be that hard to write a basic blog without one, right?</p>
<a href="https://github.com/CattoFace/barrcodes/tree/pandoc">Link To The Code On GitHub</a>
<h2 id="the-skeleton">The Skeleton</h2>
<p>At it&rsquo;s core, a blog is just one page with different chunks of text in the middle of the header-footer sandwich, so ideally, I will only need to manually write a single webpage.<br>
My HTML/CSS experience can be summed up by &ldquo;I know that I need wrap text in <code>&lt;div&gt;</code> and use Flexbox&rdquo; so with some help from Google(mostly for making divs and the logo behave with CSS&hellip;), and I&rsquo;ve got the basic body that should suffice for all of my needs:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>  &lt;<span style="color:#bb9af7">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#bb9af7">header</span> <span style="color:#7aa2f7">class</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;header&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#bb9af7">div</span> <span style="color:#7aa2f7">class</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;logo banneritem&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#bb9af7">span</span>&gt;B&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;a&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;r&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;r&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;C&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;o&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;d&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;e&lt;/<span style="color:#bb9af7">span</span>&gt;&lt;<span style="color:#bb9af7">span</span>&gt;s&lt;/<span style="color:#bb9af7">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#bb9af7">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#bb9af7">a</span> <span style="color:#7aa2f7">class</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;banneritem&#34;</span> <span style="color:#7aa2f7">href</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;home&#34;</span>&gt;Home&lt;/<span style="color:#bb9af7">a</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#bb9af7">a</span> <span style="color:#7aa2f7">class</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;banneritem&#34;</span> <span style="color:#7aa2f7">href</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;about&#34;</span>&gt;About Me&lt;/<span style="color:#bb9af7">a</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#bb9af7">header</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#bb9af7">div</span> <span style="color:#7aa2f7">id</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;content&#34;</span>&gt;&lt;/<span style="color:#bb9af7">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#bb9af7">footer</span>&gt;
</span></span><span style="display:flex;"><span>      [links and socials and stuff]
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#bb9af7">footer</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#bb9af7">body</span>&gt;
</span></span></code></pre></div><p>A little bit of browsing and picking fonts and we&rsquo;ve got the page you&rsquo;re looking at now(unless I changed it since the time of writing)<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<h2 id="preparing-some-articles">Preparing Some Articles</h2>
<p>I&rsquo;m sure most would agree with me that writing Markdown is much nicer than writing articles directly in HTML so what I need is some way to convert a Markdown file to an HTML file.<br>
An earlier version of this site used a JS library called <a href="https://marked.js.org/">marked.js</a> which can parse and convert the Markdown on the client-side browser.<br>
I later decided to save everyone else the little computation it costs and convert it on my side with another useful tool called <a href="https://pandoc.org/">Pandoc</a>, which can convert between a huge amount of text formats in the CLI.<br>
To convert all of the documents easily, I wrote a git pre-commit hook(surprisingly simple, simply write a bash script and save it as .git/hooks/pre-commit) to check if any of the Markdown files were modified later than their HTML counterparts, and convert it if it was. A very simple and effective system:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#414868;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span><span style="color:#bb9af7">for</span> md in documents/*.md; <span style="color:#bb9af7">do</span>
</span></span><span style="display:flex;"><span>  base<span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#bb9af7">$(</span>basename $md<span style="color:#bb9af7">)</span>
</span></span><span style="display:flex;"><span>  html<span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">${</span>base:<span style="color:#bb9af7">:-</span>3<span style="color:#9ece6a">}</span>.html
</span></span><span style="display:flex;"><span>  full<span style="color:#9ece6a;font-weight:bold">=</span>site/$html
</span></span><span style="display:flex;"><span>  fragment<span style="color:#9ece6a;font-weight:bold">=</span>site/fragment/$html
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> <span style="color:#9ece6a;font-weight:bold">[</span> $md -nt $full <span style="color:#9ece6a;font-weight:bold">]</span> <span style="color:#9ece6a;font-weight:bold">||</span> <span style="color:#9ece6a;font-weight:bold">[</span> $md -nt $fragment <span style="color:#9ece6a;font-weight:bold">]</span>; <span style="color:#bb9af7">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#9ece6a">echo</span> <span style="color:#9ece6a">&#34;Updating </span>$base<span style="color:#9ece6a">&#34;</span>
</span></span><span style="display:flex;"><span>    pandoc $md -o $full --template full_template.html
</span></span><span style="display:flex;"><span>    pandoc $md -o $fragment --template fragment_template.html
</span></span><span style="display:flex;"><span>    git add $full $fragment
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#9ece6a">echo</span> <span style="color:#9ece6a">&#34;</span>$base<span style="color:#9ece6a"> Already Up To Date&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#bb9af7">done</span>
</span></span></code></pre></div><p>This script converts the document twice:<br>
Once to a full html page that contains the article, for the initial website loading.<br>
The <a href="assets/full_template.html">full template</a> combines the skeleton I built earlier with the document.
And a second time to a fragment that can be quickly embedded inside the page body, for relative navigation.<br>
The <a href="assets/fragment_template.html">fragment template</a> simply combines the metadata section with the text.<br>
An earlier version only had the fragment, and loaded it into a blank body on the initial load, but that solution makes it impossible to statically serve metadata headers like the title.
The full HTML pages are already enough to have a functional blog with 0 lines of JavaScript, but my goal is to make it as fast as possible to navigate, which is why I am going to need those article fragments.
And another useful trick this script enables: I can run <code>watch .git/hooks/pre-commit</code> to have the HTML regenerate when saved and served instantly on my local web server(Take that &ldquo;Fast Refresh&rdquo;!).</p>
<h2 id="fetching-some-articles">Fetching Some Articles</h2>
<p>The plan is to listen to any links clicked, and if they are linking to another article within the website, simple fetch and replace the body of the page instead of loading an entirely new one.<br>
A minimal solution to this is just a simple <code>click</code> event listener:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>content_div <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> replace_content(doc_name) { <span style="color:#414868;font-style:italic">// replace the content with the requested document
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">if</span> (doc_name <span style="color:#9ece6a;font-weight:bold">==</span> <span style="color:#9ece6a">&#34;/&#34;</span>) doc_name <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>  fetch(<span style="color:#9ece6a">&#34;fragment/&#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> doc_name).then(response =&gt; response.text()).then(text=&gt;{
</span></span><span style="display:flex;"><span>    content_div.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> text
</span></span><span style="display:flex;"><span>    title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;title&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#9ece6a">document</span>.title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;BarrCodes - &#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> (title <span style="color:#9ece6a;font-weight:bold">?</span> title.textContent <span style="color:#9ece6a;font-weight:bold">:</span> doc_name)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#9d7cd8">var</span> r <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#bb9af7">new</span> <span style="color:#9ece6a">RegExp</span>(<span style="color:#9ece6a">&#39;^(//|[a-z]+:)&#39;</span>, <span style="color:#9ece6a">&#39;i&#39;</span>); <span style="color:#414868;font-style:italic">// check for relative link
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span><span style="color:#9ece6a">document</span>.addEventListener(<span style="color:#9ece6a">&#39;click&#39;</span>, e =&gt; { <span style="color:#414868;font-style:italic">// replace relative links with document replacements
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">const</span> origin <span style="color:#9ece6a;font-weight:bold">=</span> e.target.closest(<span style="color:#9ece6a">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (<span style="color:#9ece6a;font-weight:bold">!</span>origin) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// not a link
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc_name <span style="color:#9ece6a;font-weight:bold">=</span> origin.getAttribute(<span style="color:#9ece6a">&#34;href&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (r.test(doc_name) <span style="color:#9ece6a;font-weight:bold">||</span> doc_name.indexOf(<span style="color:#9ece6a">&#39;.&#39;</span>) <span style="color:#9ece6a;font-weight:bold">&gt;</span> <span style="color:#9ece6a;font-weight:bold">-</span><span style="color:#e0af68">1</span> <span style="color:#9ece6a;font-weight:bold">||</span> doc_name.charAt(<span style="color:#e0af68">0</span>) <span style="color:#9ece6a;font-weight:bold">!=</span> <span style="color:#9ece6a">&#39;#&#39;</span>) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// not link to a document
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  e.preventDefault() <span style="color:#414868;font-style:italic">// relative links do not actually load a new webpage
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">if</span> ((<span style="color:#9ece6a">window</span>.location.pathname.slice(<span style="color:#e0af68">1</span>) <span style="color:#9ece6a;font-weight:bold">||</span> <span style="color:#9ece6a">&#34;/&#34;</span>) <span style="color:#9ece6a;font-weight:bold">==</span> doc_name) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// already on that page
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  replace_content(doc_name)
</span></span><span style="display:flex;"><span>  history.pushState({}, <span style="color:#9ece6a">&#34;&#34;</span>, doc_name)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>the <code>indexOf, charAt</code> checks are meant for linking within the website to non-documents, like to any normal file that has a dot before the extension, or the # used in reference links<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.<br>
Now every relative link on the website will fetch and replace like planned.<br>
But of course, this is not the end, this solution has multiple things to improve upon:</p>
<ul>
<li>Going backwards in the browser within the website is now broken and doesn&rsquo;t change the content.</li>
<li>Going to an article we&rsquo;ve already visited fetches it again, which has a noticeable delay on a throttled connection, even if it is already cached.</li>
<li>It can go faster</li>
</ul>
<h2 id="improving-things">Improving Things:</h2>
<p>After a quick google search, I learned that so solve the backwards bug, I simply need to listen to the <code>popstate</code> event that happens when a browser goes back, and set the right document content:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>onpopstate <span style="color:#9ece6a;font-weight:bold">=</span> (_) =&gt; replace_content(<span style="color:#9ece6a">window</span>.location.pathname.slice(<span style="color:#e0af68">1</span>) <span style="color:#9ece6a;font-weight:bold">||</span> <span style="color:#9ece6a">&#34;/&#34;</span>) <span style="color:#414868;font-style:italic">// handle back button
</span></span></span></code></pre></div><p>Avoiding the fetch is not much more complicated, I added a Map that saves all the documents and reuses them if available instead of fetching again:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#bb9af7">const</span> cache <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#bb9af7">new</span> Map()
</span></span><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> replace_content(doc_name) { <span style="color:#414868;font-style:italic">// replace the content with the requested document
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc <span style="color:#9ece6a;font-weight:bold">=</span> cache.get(doc_name)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (<span style="color:#9ece6a;font-weight:bold">!</span>doc) {
</span></span><span style="display:flex;"><span>    fetch(<span style="color:#9ece6a">&#34;fragment/&#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> doc_name).then(response =&gt; response.text()).then(text=&gt;{
</span></span><span style="display:flex;"><span>      cache.set(doc_name, text)
</span></span><span style="display:flex;"><span>      content_div.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> text
</span></span><span style="display:flex;"><span>      title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;title&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#9ece6a">document</span>.title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;BarrCodes - &#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> (title <span style="color:#9ece6a;font-weight:bold">?</span> title.textContent <span style="color:#9ece6a;font-weight:bold">:</span> doc_name)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  } <span style="color:#bb9af7">else</span> {
</span></span><span style="display:flex;"><span>    content_div.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> doc
</span></span><span style="display:flex;"><span>    title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;title&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#9ece6a">document</span>.title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;BarrCodes - &#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> (title <span style="color:#9ece6a;font-weight:bold">?</span> title.textContent <span style="color:#9ece6a;font-weight:bold">:</span> doc_name)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And finally:</p>
<h2 id="going-faster">Going Faster</h2>
<p>This section takes the idea from the now famous <a href="https://www.reddit.com/r/programming/comments/1g75r84/how_is_this_website_so_fast_breaking_down_the/">McMASTER-CARR</a> website.<br>
The easiest way to get to a new article faster is to simply start loading it earlier, usually we start loading a web page once a user clicks a link, but I can do better.<br>
Before a user clicks a link, they will almost certainly hover over it(unless they tabbed into it with their keyboard), and that gives us a heads-up that the user <em>might</em> navigate tho that page, and that&rsquo;s what this section exploits.<br>
By listening to the <code>mouseover</code> event, I can start fetching a document before the user clicks the link:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> prefetch(doc_name) { <span style="color:#414868;font-style:italic">// download the requested document if it is not already in cache
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc <span style="color:#9ece6a;font-weight:bold">=</span> cache.get(doc_name)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (<span style="color:#9ece6a;font-weight:bold">!</span>doc) {
</span></span><span style="display:flex;"><span>    fetch(<span style="color:#9ece6a">&#34;fragment/&#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> doc_name).then(response =&gt; response.text()).then(text=&gt;cache.set(doc_name,text))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#9ece6a">document</span>.addEventListener(<span style="color:#9ece6a">&#39;mouseover&#39;</span>, e =&gt; { <span style="color:#414868;font-style:italic">// start fetching document on hover
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">const</span> origin <span style="color:#9ece6a;font-weight:bold">=</span> e.target.closest(<span style="color:#9ece6a">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (<span style="color:#9ece6a;font-weight:bold">!</span>origin) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// not a link
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc_name <span style="color:#9ece6a;font-weight:bold">=</span> origin.getAttribute(<span style="color:#9ece6a">&#34;href&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (r.test(doc_name) <span style="color:#9ece6a;font-weight:bold">||</span> doc_name.indexOf(<span style="color:#9ece6a">&#39;.&#39;</span>) <span style="color:#9ece6a;font-weight:bold">&gt;</span> <span style="color:#9ece6a;font-weight:bold">-</span><span style="color:#e0af68">1</span> <span style="color:#9ece6a;font-weight:bold">||</span> doc_name.indexOf(<span style="color:#9ece6a">&#39;#&#39;</span>) <span style="color:#9ece6a;font-weight:bold">&gt;</span> <span style="color:#9ece6a;font-weight:bold">-</span><span style="color:#e0af68">1</span>) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// not link to a document
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">if</span> ((<span style="color:#9ece6a">window</span>.location.pathname.slice(<span style="color:#e0af68">1</span>) <span style="color:#9ece6a;font-weight:bold">||</span> <span style="color:#9ece6a">&#34;/&#34;</span>) <span style="color:#9ece6a;font-weight:bold">==</span> doc_name) <span style="color:#bb9af7">return</span>; <span style="color:#414868;font-style:italic">// already on that page
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  prefetch(doc_name)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>This solution works great when the user takes a moment to decide if they want to navigate to the new page, but if they click the link immediately, there&rsquo;s a good chance the fetch will not finish and <code>replace_content</code> will start a second fetch, which will both cause him to download the document twice(think of all those precious bytes!) and more importantly, throw away the small time advantage I gained by fetching early.<br>
To solve this issue, I decided to simply store the fetch <code>Promise</code> in the cache when the user hovers over the link, and let <code>replace_content</code> check if it&rsquo;s a <code>Promise</code> or an actual document and behave accordingly:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> get_document(doc_name) { <span style="color:#414868;font-style:italic">// download the requested document if it is not already in cache
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc <span style="color:#9ece6a;font-weight:bold">=</span> cache.get(doc_name)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (<span style="color:#9ece6a;font-weight:bold">!</span>doc) {
</span></span><span style="display:flex;"><span>    doc <span style="color:#9ece6a;font-weight:bold">=</span> fetch(<span style="color:#9ece6a">&#34;fragment/&#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> doc_name).then(response =&gt; response.text())
</span></span><span style="display:flex;"><span>    cache.set(doc_name, doc) <span style="color:#414868;font-style:italic">// doc is a promise until resolved by replace_content
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">return</span> doc
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> replace_content(doc_name) { <span style="color:#414868;font-style:italic">// replace the content with the requested document
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#9d7cd8">let</span> doc <span style="color:#9ece6a;font-weight:bold">=</span> get_document(doc_name)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (doc <span style="color:#bb9af7">instanceof</span> <span style="color:#9ece6a">Promise</span>) { <span style="color:#414868;font-style:italic">// if promise, convert to actual doc and save
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>    doc.then(resolved =&gt; {
</span></span><span style="display:flex;"><span>      cache.set(doc_name, resolved)
</span></span><span style="display:flex;"><span>      content_div.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> resolved
</span></span><span style="display:flex;"><span>      title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;title&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#9ece6a">document</span>.title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;BarrCodes - &#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> (title <span style="color:#9ece6a;font-weight:bold">?</span> title.textContent <span style="color:#9ece6a;font-weight:bold">:</span> doc_name)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  } <span style="color:#bb9af7">else</span> {
</span></span><span style="display:flex;"><span>    content_div.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> doc
</span></span><span style="display:flex;"><span>    title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;title&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#9ece6a">document</span>.title <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">&#34;BarrCodes - &#34;</span> <span style="color:#9ece6a;font-weight:bold">+</span> (title <span style="color:#9ece6a;font-weight:bold">?</span> title.textContent <span style="color:#9ece6a;font-weight:bold">:</span> doc_name)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>prefetch</code> was renamed to <code>get_document</code> since it now behaves sort of like a custom fetch.</p>
<h2 id="final-touches">Final Touches</h2>
<p>The website pretty much works as it is now but there are a few things that can be improved:</p>
<h3 id="dark-theme">Dark Theme</h3>
<p>Everyone likes a dark theme option for a website(ideally by default), and it&rsquo;s not hard to implement at all, so here I go.<br>
All that is needed is a button that toggles a boolean, and a few CSS properties:</p>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#bb9af7">header</span>&gt;...&lt;<span style="color:#bb9af7">button</span> <span style="color:#7aa2f7">id</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;toggle_theme&#34;</span> <span style="color:#7aa2f7">onclick</span><span style="color:#9ece6a;font-weight:bold">=</span><span style="color:#9ece6a">&#34;toggle_theme()&#34;</span>&gt;Dark&lt;<span style="color:#bb9af7">br</span>/&gt;Theme&lt;/<span style="color:#bb9af7">button</span>&gt;&lt;/<span style="color:#bb9af7">header</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#9d7cd8">function</span> toggle_theme() { <span style="color:#414868;font-style:italic">// toggle between dark and light theme(default dark)
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  <span style="color:#bb9af7">const</span> light <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.body.classList.toggle(<span style="color:#9ece6a">&#34;light&#34;</span>)
</span></span><span style="display:flex;"><span>  theme_button.innerHTML <span style="color:#9ece6a;font-weight:bold">=</span> light <span style="color:#9ece6a;font-weight:bold">?</span> <span style="color:#9ece6a">&#34;Light&lt;br/&gt;Theme&#34;</span> <span style="color:#9ece6a;font-weight:bold">:</span> <span style="color:#9ece6a">&#34;Dark&lt;br/&gt;Theme&#34;</span>
</span></span><span style="display:flex;"><span>  localStorage.setItem(<span style="color:#9ece6a">&#39;light_mode&#39;</span>, light)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>theme_button <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;toggle_theme&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#bb9af7">if</span> (localStorage.getItem(<span style="color:#9ece6a">&#34;light_mode&#34;</span>) <span style="color:#9ece6a;font-weight:bold">===</span> <span style="color:#9ece6a">&#34;true&#34;</span>) toggle_theme(); <span style="color:#414868;font-style:italic">// load saved theme
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-CSS" data-lang="CSS"><span style="display:flex;"><span>.<span style="color:#ff9e64">light</span>{
</span></span><span style="display:flex;"><span>  --main-bg: <span style="color:#e0af68">#EEEEEE</span>;
</span></span><span style="display:flex;"><span>  --main-text: <span style="color:#e0af68">#111111</span>;
</span></span><span style="display:flex;"><span>  --link-color: <span style="color:#e0af68">darkblue</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And it&rsquo;s even saved across visits!</p>
<h3 id="reducing-the-latency-a-little-more">Reducing The Latency A Little More</h3>
<ul>
<li>
<p>Looking at the browser&rsquo;s network tab, there was a noticeable latency fetching the CSS for the fonts from <a href="https://fonts.google.com/">Google Fonts</a>, but not so much fetching the fonts themselves, so I simply copied the content of the CSS into my own CSS file and that solved it and improved the latency.</p>
</li>
<li>
<p>Initially, I put the <code>&lt;script&gt;</code> tag at the end of the body of the HTML file, which causes it to be parsed and executed last, this was needed because it is not possible to interact with the DOM and insert a document into the body before the DOM actually loads.
The current solution puts the script in the <code>&lt;head&gt;</code> of the HTML, and uses a <code>DOMContentLoaded</code> event to do only the things that require the DOM happen after it&rsquo;s loaded:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#9ece6a">window</span>.addEventListener(<span style="color:#9ece6a">&#34;DOMContentLoaded&#34;</span>, _ =&gt; {
</span></span><span style="display:flex;"><span>  content_div <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>  theme_button <span style="color:#9ece6a;font-weight:bold">=</span> <span style="color:#9ece6a">document</span>.getElementById(<span style="color:#9ece6a">&#34;toggle_theme&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#bb9af7">if</span> (localStorage.getItem(<span style="color:#9ece6a">&#34;light_mode&#34;</span>) <span style="color:#9ece6a;font-weight:bold">===</span> <span style="color:#9ece6a">&#34;true&#34;</span>) toggle_theme(); <span style="color:#414868;font-style:italic">// load saved theme
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>  replace_content(<span style="color:#9ece6a">window</span>.location.pathname.slice(<span style="color:#e0af68">1</span>) <span style="color:#9ece6a;font-weight:bold">||</span> <span style="color:#9ece6a">&#34;/&#34;</span>) <span style="color:#414868;font-style:italic">// load current doc
</span></span></span><span style="display:flex;"><span><span style="color:#414868;font-style:italic"></span>})
</span></span></code></pre></div><p>I was not actually able to measure a statistically significant difference from this change, but I kept it anyway, someone else can probably explain what is the best practice for this.</p>
<h2 id="deployment">Deployment</h2>
<p>Finally, I need to actually host this website somewhere, I decided to go with <a href="https://pages.cloudflare.com/">Cloudflare Pages</a>, I already use them for my other domain(just for DNS) and I have no complaints.<br>
There is not much to talk about that isn&rsquo;t in their getting started documentation, I connected the GitHub repository and now every push to the preview or production branches and Cloudflare automatically redeploys the website(which only includes cloning it and distributing it over their network, since this is a static website).</p>
<h2 id="unexplained-behaviour">Unexplained Behaviour</h2>
<p>A surprising behavior I found while finalizing the website design, is that if I have an active Zoom call in another tab, having my <code>onhover</code> listener adds a significant delay before the following click can load the page.<br>
Disabling the <code>onhover</code> listener or clicking a link without hovering first(i.e using the keyboard) still fetches and displays the document quickly.<br>
This behaviour goes back to normal the moment the call ends.&ndash;
I can find absolutely no explanation for this behaviour.</p>
<h2 id="summary">Summary</h2>
<p>As expected, I don&rsquo;t actually need any frameworks to build a basic and performant blog, or even a lot of JavaScript, the <a href="script.js">script.js</a> file is exactly 56 lines long, without any unreadable minification.<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup><br>
Of course modern frameworks have upsides compared to this, there is also <a href="https://gohugo.io/">Hugo</a>, the static website generator written in Go, which pretty much does exactly what I&rsquo;m doing with <code>pandoc</code> plus a few more web and blog oriented features, but I wanted to see what I can do with as little as possible, it&rsquo;s possible that I&rsquo;ll switch to it in the future.<br>
Sure, it could be nicer, it could have a dynamic home page that doesn&rsquo;t need to be updated when a new article is published, it could have a comments system so other people can more easily send feedback(<a href="https://utteranc.es/">utterances</a> looks like an interesting solution, might add it to all articles later).<br>
Maybe it <em>will</em> be nicer in the future, but for now, this is all I need.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>I lied a little, font picking and the footer design happened after implementing the document system but I&rsquo;d rather keep all the design writing together.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>This was actually added as I was testing this post and learning that the <code>script.js</code> link and the reference links are broken.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>The name of this article changed a couple times to reflect small late changes, I hoped I could keep it at a nice 50, but it is what it is.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

<div style="overflow:auto">


  <a style="float:right" href="/graveler-simulation/">Next: Exploding Pokemon As Fast As Possible</a>

</div>
<script src="https://utteranc.es/client.js"
repo="CattoFace/barrcodes"
issue-term="pathname"
label="utterances"
theme="github-dark"
crossorigin="anonymous"
async>
</script>
</main>
    <footer><footer>
  <a class="footeritem" href="/">
    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z"/>
    </svg>
    <span>Home</span>
  </a>
  <a class="footeritem" href="mailto:blog@barrisrael.com">
    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/></svg>
    <span>E-Mail</span>
  </a>
  <a class="footeritem" href="https://github.barrisrael.com">
    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
    </svg>
    <span>GitHub</span>
  </a>
</footer>
</footer>
</body>
</html>
